<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω - –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å—Ç—É–¥–µ–Ω—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4a6fa5 0%, #385d8a 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .form-container {
            padding: 40px;
        }
        
        .error-message {
            background-color: #fadbd8;
            color: #e74c3c;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #e74c3c;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #4a6fa5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .rating-slider {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-value {
            min-width: 40px;
            font-weight: bold;
            color: #4a6fa5;
            font-size: 1.2rem;
            text-align: center;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: #e0e0e0;
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4a6fa5;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4a6fa5;
            cursor: pointer;
            border: none;
        }
        
        .difficulty-indicator {
            height: 8px;
            background: linear-gradient(to right, #27ae60, #f39c12, #e74c3c);
            border-radius: 4px;
            margin-top: 5px;
            position: relative;
        }
        
        .difficulty-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid #4a6fa5;
            border-radius: 50%;
            top: -6px;
            transform: translateX(-50%);
            transition: left 0.3s;
        }
        
        .subject-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            cursor: pointer;
        }
        
        .subject-select:focus {
            border-color: #4a6fa5;
            outline: none;
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 2px solid #f0f0f0;
        }
        
        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .date-display {
            display: inline-block;
            padding: 10px 20px;
            background: #e3f2fd;
            border-radius: 8px;
            color: #2196f3;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
            }
            
            .container {
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù –î–æ–±–∞–≤–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω</h1>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–º —É—á–µ–±–Ω–æ–º —Å–æ–±—ã—Ç–∏–∏</p>
        </div>
        
        <div class="form-container">
            {% if error %}
                <div class="error-message">
                    <strong>–û—à–∏–±–∫–∞:</strong> {{ error }}
                </div>
            {% endif %}
            
            {% if selected_date %}
                <div class="date-display">
                    üìÖ –í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞: {{ selected_date }}
                </div>
            {% endif %}
            
            <form method="POST" action="{% url 'calendar_app:add_event' %}">
                {% csrf_token %}
                
                {% if selected_date %}
                    <input type="hidden" name="date" value="{{ selected_date }}">
                {% endif %}
                
                <div class="form-group">
                    <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–∞ <span class="required">*</span></label>
                    <input type="text" id="name" name="name" class="form-control" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–¥–∞—á–∞ –∫—É—Ä—Å–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã" 
                           value="{{ form_data.name|default:'' }}" required maxlength="100">
                </div>
                
                <div class="form-group">
                    <label for="subject">–ü—Ä–µ–¥–º–µ—Ç <span class="required">*</span></label>
                    <select id="subject" name="subject" class="subject-select" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
                        <option value="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" {% if form_data.subject == "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" %}selected{% endif %}>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</option>
                        <option value="–§–∏–∑–∏–∫–∞" {% if form_data.subject == "–§–∏–∑–∏–∫–∞" %}selected{% endif %}>–§–∏–∑–∏–∫–∞</option>
                        <option value="–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ" {% if form_data.subject == "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ" %}selected{% endif %}>–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                        <option value="–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫" {% if form_data.subject == "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫" %}selected{% endif %}>–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫</option>
                        <option value="–ò—Å—Ç–æ—Ä–∏—è" {% if form_data.subject == "–ò—Å—Ç–æ—Ä–∏—è" %}selected{% endif %}>–ò—Å—Ç–æ—Ä–∏—è</option>
                        <option value="–§–∏–ª–æ—Å–æ—Ñ–∏—è" {% if form_data.subject == "–§–∏–ª–æ—Å–æ—Ñ–∏—è" %}selected{% endif %}>–§–∏–ª–æ—Å–æ—Ñ–∏—è</option>
                        <option value="–≠–∫–æ–Ω–æ–º–∏–∫–∞" {% if form_data.subject == "–≠–∫–æ–Ω–æ–º–∏–∫–∞" %}selected{% endif %}>–≠–∫–æ–Ω–æ–º–∏–∫–∞</option>
                        <option value="–•–∏–º–∏—è" {% if form_data.subject == "–•–∏–º–∏—è" %}selected{% endif %}>–•–∏–º–∏—è</option>
                        <option value="–ë–∏–æ–ª–æ–≥–∏—è" {% if form_data.subject == "–ë–∏–æ–ª–æ–≥–∏—è" %}selected{% endif %}>–ë–∏–æ–ª–æ–≥–∏—è</option>
                        <option value="other">–î—Ä—É–≥–æ–π –ø—Ä–µ–¥–º–µ—Ç...</option>
                    </select>
                    <input type="text" id="custom_subject" name="custom_subject" class="form-control" 
                           style="margin-top: 10px; display: none;" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="difficulty">–°–ª–æ–∂–Ω–æ—Å—Ç—å: <span id="difficultyValue">5</span>/10</label>
                        <div class="rating-slider">
                            <span class="slider-value">1</span>
                            <input type="range" id="difficulty" name="difficulty" 
                                   min="1" max="10" value="{{ form_data.difficulty|default:'5' }}" 
                                   class="form-control" required>
                            <span class="slider-value">10</span>
                        </div>
                        <div class="difficulty-indicator">
                            <div class="difficulty-marker" id="difficultyMarker" style="left: 50%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8rem; color: #666;">
                            <span>–õ–µ–≥–∫–æ</span>
                            <span>–°—Ä–µ–¥–Ω–µ</span>
                            <span>–°–ª–æ–∂–Ω–æ</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="time_required">–í—Ä–µ–º—è–∑–∞—Ç—Ä–∞—Ç–Ω–æ—Å—Ç—å: <span id="timeValue">5</span>/10</label>
                        <div class="rating-slider">
                            <span class="slider-value">1</span>
                            <input type="range" id="time_required" name="time_required" 
                                   min="1" max="10" value="{{ form_data.time_required|default:'5' }}" 
                                   class="form-control" required>
                            <span class="slider-value">10</span>
                        </div>
                        <div class="difficulty-indicator">
                            <div class="difficulty-marker" id="timeMarker" style="left: 50%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8rem; color: #666;">
                            <span>–ú–∞–ª–æ</span>
                            <span>–£–º–µ—Ä–µ–Ω–Ω–æ</span>
                            <span>–ú–Ω–æ–≥–æ</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="date">–î–∞—Ç–∞ –¥–µ–¥–ª–∞–π–Ω–∞ <span class="required">*</span></label>
                    <input type="date" id="date" name="date" class="form-control" 
                        value="{{ form_data.date|default:selected_date|default:today }}" 
                        min="2024-01-01" max="2026-12-31" required>
                </div>
                
                <div class="form-actions">
                    <a href="{% url 'calendar_app:calendar' %}" class="btn btn-secondary">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—é
                    </a>
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–∑—É–Ω–∫–æ–≤
        function updateSlider(slider, valueElement, marker) {
            const value = parseInt(slider.value);
            valueElement.textContent = value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ (–æ—Ç 0% –¥–æ 100%)
            const percent = ((value - 1) / 9) * 100;
            marker.style.left = `${percent}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è
            if (value <= 3) {
                valueElement.style.color = '#27ae60';
            } else if (value <= 7) {
                valueElement.style.color = '#f39c12';
            } else {
                valueElement.style.color = '#e74c3c';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–∑—É–Ω–∫–æ–≤
        const difficultySlider = document.getElementById('difficulty');
        const difficultyValue = document.getElementById('difficultyValue');
        const difficultyMarker = document.getElementById('difficultyMarker');
        
        const timeSlider = document.getElementById('time_required');
        const timeValue = document.getElementById('timeValue');
        const timeMarker = document.getElementById('timeMarker');
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        updateSlider(difficultySlider, difficultyValue, difficultyMarker);
        updateSlider(timeSlider, timeValue, timeMarker);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        difficultySlider.addEventListener('input', () => {
            updateSlider(difficultySlider, difficultyValue, difficultyMarker);
        });
        
        timeSlider.addEventListener('input', () => {
            updateSlider(timeSlider, timeValue, timeMarker);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
        const subjectSelect = document.getElementById('subject');
        const customSubjectInput = document.getElementById('custom_subject');
        
        subjectSelect.addEventListener('change', function() {
            if (this.value === 'other') {
                customSubjectInput.style.display = 'block';
                customSubjectInput.required = true;
                // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                customSubjectInput.name = 'subject';
                subjectSelect.disabled = true;
                subjectSelect.name = '';
            } else {
                customSubjectInput.style.display = 'none';
                customSubjectInput.required = false;
                customSubjectInput.name = 'custom_subject';
                subjectSelect.disabled = false;
                subjectSelect.name = 'subject';
            }
        });
        
        // –ï—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω "–¥—Ä—É–≥–æ–π" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (subjectSelect.value === 'other') {
            customSubjectInput.style.display = 'block';
            customSubjectInput.required = true;
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
        const dateInput = document.getElementById('date');
        const today = new Date().toISOString().split('T')[0];
        dateInput.min = today;
        
        // –ï—Å–ª–∏ –¥–∞—Ç–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é
        if (!dateInput.value) {
            dateInput.value = today;
        }
    </script>
</body>
</html>